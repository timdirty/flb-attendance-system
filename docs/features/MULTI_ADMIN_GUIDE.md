# ğŸ‘¥ å¤šç®¡ç†å“¡æ”¯æ´æŒ‡å—

## ğŸ“– åŠŸèƒ½æ¦‚è¿°

FLB ç°½åˆ°ç³»çµ±ç¾å·²æ”¯æ´**å¤šç®¡ç†å“¡æ¨¡å¼**ï¼Œå¯ä»¥åŒæ™‚å°‡åŒ¯æ¬¾é€šçŸ¥ã€è«‹å‡ç”³è«‹ç­‰é‡è¦è¨Šæ¯ç™¼é€çµ¦å¤šä½ç®¡ç†å“¡ï¼Œä¸å†å±€é™æ–¼å–®ä¸€ç®¡ç†å“¡æˆ–ç¾¤çµ„ã€‚

---

## âœ¨ åŠŸèƒ½ç‰¹è‰²

- âœ… **æ”¯æ´å¤šä½ç®¡ç†å“¡**ï¼šå¯è¨­å®šå¤šå€‹ç®¡ç†å“¡ User ID
- âœ… **ä¸‰ç¨®è¨­å®šæ–¹å¼**ï¼šç’°å¢ƒè®Šæ•¸ã€è¨­å®šæª”æ¡ˆã€å‘å¾Œç›¸å®¹å–®ä¸€ç®¡ç†å“¡
- âœ… **å€‹åˆ¥æ¨æ’­**ï¼šæ¯ä½ç®¡ç†å“¡éƒ½æœƒæ”¶åˆ°ç¨ç«‹çš„é€šçŸ¥è¨Šæ¯
- âœ… **éˆæ´»ç®¡ç†**ï¼šå¯é€éè¨­å®šæª”å•Ÿç”¨/åœç”¨å€‹åˆ¥ç®¡ç†å“¡
- âœ… **é€šçŸ¥é¡å‹ç¯©é¸**ï¼šæœªä¾†å¯æ“´å……ä¸åŒç®¡ç†å“¡æ¥æ”¶ä¸åŒé¡å‹é€šçŸ¥
- âœ… **å‘å¾Œç›¸å®¹**ï¼šç¾æœ‰çš„ `LINE_USER_ID` è¨­å®šä»ç„¶æœ‰æ•ˆ

---

## ğŸ”§ è¨­å®šæ–¹å¼

### æ–¹å¼ä¸€ï¼šé€éè¨­å®šæª”æ¡ˆï¼ˆæ¨è–¦ï¼‰

**æª”æ¡ˆä½ç½®**ï¼š`src/data/admin-users.json`

```json
[
  {
    "userId": "Udb51363eb6fdc605a6a9816379a38103",
    "name": "ä¸»è¦ç®¡ç†å“¡",
    "role": "admin",
    "enabled": true,
    "createdAt": "2024-11-21T05:45:00.000Z",
    "notificationTypes": [
      "remittance",
      "leave",
      "registration",
      "teacher_binding"
    ]
  },
  {
    "userId": "U1234567890abcdef",
    "name": "è²¡å‹™ç®¡ç†å“¡",
    "role": "finance",
    "enabled": true,
    "createdAt": "2024-11-21T06:00:00.000Z",
    "notificationTypes": [
      "remittance"
    ]
  }
]
```

**æ¬„ä½èªªæ˜**ï¼š
- `userId`ï¼šç®¡ç†å“¡çš„ LINE User IDï¼ˆå¿…å¡«ï¼‰
- `name`ï¼šç®¡ç†å“¡åç¨±ï¼ˆé¸å¡«ï¼Œæ–¹ä¾¿è­˜åˆ¥ï¼‰
- `role`ï¼šè§’è‰²æ¨™ç±¤ï¼ˆé¸å¡«ï¼Œå¦‚ adminã€financeã€teacher ç­‰ï¼‰
- `enabled`ï¼šæ˜¯å¦å•Ÿç”¨ï¼ˆtrue/falseï¼Œé è¨­ trueï¼‰
- `createdAt`ï¼šå»ºç«‹æ™‚é–“ï¼ˆé¸å¡«ï¼‰
- `notificationTypes`ï¼šæ¥æ”¶çš„é€šçŸ¥é¡å‹ï¼ˆé¸å¡«ï¼Œæœªä¾†åŠŸèƒ½ï¼‰

---

### æ–¹å¼äºŒï¼šé€éç’°å¢ƒè®Šæ•¸

åœ¨ `.env` æª”æ¡ˆä¸­è¨­å®šï¼ˆé€—è™Ÿåˆ†éš”ï¼‰ï¼š

```bash
# å¤šç®¡ç†å“¡ User IDï¼ˆé€—è™Ÿåˆ†éš”ï¼‰
ADMIN_USER_IDS=Udb51363eb6fdc605a6a9816379a38103,U1234567890abcdef,U0987654321fedcba

# å•Ÿç”¨å¤šç®¡ç†å“¡æ¨¡å¼ï¼ˆé è¨­ï¼štrueï¼‰
ENABLE_MULTI_ADMINS=true

# è‡ªè¨‚è¨­å®šæª”è·¯å¾‘ï¼ˆé¸å¡«ï¼‰
ADMIN_CONFIG_FILE=src/data/admin-users.json
```

**å„ªé»**ï¼š
- âœ… å¿«é€Ÿè¨­å®š
- âœ… é©åˆå°‘é‡ç®¡ç†å“¡

**ç¼ºé»**ï¼š
- âŒ ç„¡æ³•è¨­å®šå€‹åˆ¥å•Ÿç”¨/åœç”¨
- âŒ ç„¡æ³•è¨˜éŒ„é¡å¤–è³‡è¨Šï¼ˆåç¨±ã€è§’è‰²ç­‰ï¼‰

---

### æ–¹å¼ä¸‰ï¼šå–®ä¸€ç®¡ç†å“¡ï¼ˆå‘å¾Œç›¸å®¹ï¼‰

ä¿æŒç¾æœ‰è¨­å®šä¸è®Šï¼š

```bash
# .env
LINE_USER_ID=Udb51363eb6fdc605a6a9816379a38103
```

ç³»çµ±æœƒè‡ªå‹•å°‡æ­¤ç®¡ç†å“¡åŠ å…¥ç®¡ç†å“¡åˆ—è¡¨ã€‚

---

## ğŸ“‹ å„ªå…ˆç´šè¦å‰‡

ç³»çµ±æœƒä¾ç…§ä»¥ä¸‹å„ªå…ˆç´šåˆä½µæ‰€æœ‰ç®¡ç†å“¡ï¼š

1. **è¨­å®šæª”æ¡ˆ** (`src/data/admin-users.json`) - **æœ€é«˜å„ªå…ˆç´š**
2. **ç’°å¢ƒè®Šæ•¸** (`ADMIN_USER_IDS`)
3. **å–®ä¸€ç®¡ç†å“¡** (`LINE_USER_ID`) - **å‘å¾Œç›¸å®¹**

**ç¯„ä¾‹**ï¼š

```json
// src/data/admin-users.json
[{"userId": "U111", "enabled": true}]
```

```bash
# .env
ADMIN_USER_IDS=U222,U333
LINE_USER_ID=U444
```

**æœ€çµ‚çµæœ**ï¼šç³»çµ±æœƒç™¼é€çµ¦ `U111`, `U222`, `U333`, `U444` å››ä½ç®¡ç†å“¡

---

## ğŸ¯ ä½¿ç”¨å ´æ™¯

### å ´æ™¯ä¸€ï¼šåŒ¯æ¬¾é€šçŸ¥

ç•¶å®¢æˆ¶ç™¼é€åŒ¯æ¬¾è¨Šæ¯æ™‚ï¼š

```
å®¢æˆ¶ï¼šã€Œæˆ‘å·²ç¶“è½‰å¸³ 1500 å…ƒäº†ã€
```

**ç³»çµ±è¡Œç‚º**ï¼š
1. âœ… ç™¼é€ Flex Message åˆ°ç®¡ç†å“¡ç¾¤çµ„ï¼ˆå¦‚æœ‰è¨­å®š `REMITTANCE_GROUP_ID`ï¼‰
2. âœ… ç™¼é€ Flex Message çµ¦æ‰€æœ‰ç®¡ç†å“¡ï¼ˆå€‹åˆ¥æ¨æ’­ï¼‰
3. âœ… å›è¦†å®¢æˆ¶ç¢ºèªè¨Šæ¯

**æ—¥èªŒè¼¸å‡º**ï¼š
```
ğŸ“¤ ç™¼é€åŒ¯æ¬¾é€šçŸ¥çµ¦ 3 ä½ç®¡ç†å“¡...
âœ… å·²ç™¼é€åŒ¯æ¬¾é€šçŸ¥çµ¦ç®¡ç†å“¡: Udb51363eb6fdc605a6a9816379a38103
âœ… å·²ç™¼é€åŒ¯æ¬¾é€šçŸ¥çµ¦ç®¡ç†å“¡: U1234567890abcdef
âœ… å·²ç™¼é€åŒ¯æ¬¾é€šçŸ¥çµ¦ç®¡ç†å“¡: U0987654321fedcba
```

---

### å ´æ™¯äºŒï¼šç·Šæ€¥é€šçŸ¥

ç™¼é€é‡è¦ç³»çµ±é€šçŸ¥çµ¦æ‰€æœ‰ç®¡ç†å“¡ï¼š

```javascript
// åœ¨ç¨‹å¼ç¢¼ä¸­ä½¿ç”¨
const adminIds = config.getAllAdminUserIds();
for (const adminId of adminIds) {
    await sendLineMessage('âš ï¸ ç³»çµ±ç·Šæ€¥é€šçŸ¥', adminId);
}
```

---

## ğŸ› ï¸ API ä½¿ç”¨

### ç²å–æ‰€æœ‰ç®¡ç†å“¡ ID

```javascript
const config = require('./src/config');

// ç²å–æ‰€æœ‰å•Ÿç”¨çš„ç®¡ç†å“¡ ID
const adminIds = config.getAllAdminUserIds();
console.log(adminIds);
// è¼¸å‡º: ['Udb51363eb6fdc605a6a9816379a38103', 'U1234567890abcdef']
```

### æª¢æŸ¥æ˜¯å¦ç‚ºç®¡ç†å“¡

```javascript
const config = require('./src/config');

const isAdmin = config.isAdmin('Udb51363eb6fdc605a6a9816379a38103');
console.log(isAdmin); // è¼¸å‡º: true
```

---

## ğŸ“Š ç®¡ç†å“¡è¨­å®šæª”ç¯„ä¾‹

### åŸºæœ¬è¨­å®š

```json
[
  {
    "userId": "Udb51363eb6fdc605a6a9816379a38103",
    "name": "ä¸»è¦ç®¡ç†å“¡",
    "enabled": true
  }
]
```

### å®Œæ•´è¨­å®šï¼ˆå«è§’è‰²èˆ‡é€šçŸ¥é¡å‹ï¼‰

```json
[
  {
    "userId": "Udb51363eb6fdc605a6a9816379a38103",
    "name": "ç³»çµ±ç®¡ç†å“¡",
    "role": "system_admin",
    "enabled": true,
    "createdAt": "2024-11-21T05:45:00.000Z",
    "notificationTypes": ["remittance", "leave", "registration", "teacher_binding", "system"]
  },
  {
    "userId": "U1111111111111111",
    "name": "è²¡å‹™ç®¡ç†å“¡",
    "role": "finance",
    "enabled": true,
    "createdAt": "2024-11-21T06:00:00.000Z",
    "notificationTypes": ["remittance"]
  },
  {
    "userId": "U2222222222222222",
    "name": "æ•™å‹™ç®¡ç†å“¡",
    "role": "academic",
    "enabled": true,
    "createdAt": "2024-11-21T06:15:00.000Z",
    "notificationTypes": ["leave", "teacher_binding"]
  },
  {
    "userId": "U3333333333333333",
    "name": "å·²åœç”¨çš„ç®¡ç†å“¡",
    "role": "admin",
    "enabled": false,
    "createdAt": "2024-11-01T00:00:00.000Z",
    "disabledAt": "2024-11-20T00:00:00.000Z",
    "disabledReason": "å·²é›¢è·"
  }
]
```

---

## ğŸ§ª æ¸¬è©¦æ­¥é©Ÿ

### 1. å»ºç«‹æ¸¬è©¦è¨­å®šæª”

```bash
# å»ºç«‹æ¸¬è©¦ç®¡ç†å“¡è¨­å®š
cat > src/data/admin-users.json << 'EOF'
[
  {
    "userId": "Udb51363eb6fdc605a6a9816379a38103",
    "name": "æ¸¬è©¦ç®¡ç†å“¡",
    "enabled": true
  }
]
EOF
```

### 2. æ¸¬è©¦ç²å–ç®¡ç†å“¡åˆ—è¡¨

```javascript
// åœ¨ Node.js æ§åˆ¶å°ä¸­æ¸¬è©¦
const config = require('./src/config');
console.log('æ‰€æœ‰ç®¡ç†å“¡:', config.getAllAdminUserIds());
```

### 3. æ¸¬è©¦åŒ¯æ¬¾é€šçŸ¥

åœ¨ LINE ä¸­ç™¼é€ï¼š
```
æˆ‘å·²ç¶“è½‰å¸³ 1500 å…ƒäº†
```

**é æœŸçµæœ**ï¼š
- âœ… æ‰€æœ‰å•Ÿç”¨çš„ç®¡ç†å“¡éƒ½æœƒæ”¶åˆ° Flex Message
- âœ… æ—¥èªŒé¡¯ç¤ºç™¼é€æˆåŠŸè¨Šæ¯

---

## ğŸ” é™¤éŒ¯æŒ‡å—

### å•é¡Œï¼šç®¡ç†å“¡æ²’æœ‰æ”¶åˆ°é€šçŸ¥

**æª¢æŸ¥æ­¥é©Ÿ**ï¼š

1. **ç¢ºèªè¨­å®šæª”æ ¼å¼æ­£ç¢º**
```bash
cat src/data/admin-users.json | python -m json.tool
```

2. **æª¢æŸ¥ç®¡ç†å“¡æ˜¯å¦å•Ÿç”¨**
```json
{
  "userId": "U123...",
  "enabled": true  // å¿…é ˆæ˜¯ true
}
```

3. **æŸ¥çœ‹ç³»çµ±æ—¥èªŒ**
```bash
# æœ¬æ©Ÿ
npm run dev

# Docker
docker logs flb-attendance-system -f | grep "ç®¡ç†å“¡"
```

4. **æ¸¬è©¦ API**
```bash
curl http://localhost:3000/api/test-admin
```

---

### å•é¡Œï¼šè¨­å®šæª”æ¡ˆç„¡æ³•è®€å–

**éŒ¯èª¤è¨Šæ¯**ï¼š
```
âŒ è®€å–ç®¡ç†å“¡è¨­å®šæª”æ¡ˆå¤±æ•—: Unexpected token...
```

**è§£æ±ºæ–¹å¼**ï¼š
```bash
# é©—è­‰ JSON æ ¼å¼
cat src/data/admin-users.json | jq .

# å¦‚æœæ²’æœ‰ jqï¼Œä½¿ç”¨ Node.js
node -e "console.log(JSON.parse(require('fs').readFileSync('src/data/admin-users.json')))"
```

---

## ğŸ“š ç›¸é—œæª”æ¡ˆ

- **é…ç½®æ¨¡çµ„**ï¼š`src/config.js` (ç¬¬ 62-75, 377-429 è¡Œ)
- **ç®¡ç†å“¡è¨­å®šæª”**ï¼š`src/data/admin-users.json`
- **åŒ¯æ¬¾é€šçŸ¥å‡½æ•¸**ï¼š`server.js` (ç¬¬ 3752-3832 è¡Œ)
- **ç’°å¢ƒè®Šæ•¸ç¯„ä¾‹**ï¼š`env.example` (ç¬¬ 5-14 è¡Œ)

---

## ğŸš€ æœªä¾†æ“´å……

- [ ] ç®¡ç†å“¡æ¬Šé™åˆ†ç´šï¼ˆå”¯è®€ã€ç·¨è¼¯ã€å®Œæ•´ï¼‰
- [ ] é€šçŸ¥é¡å‹ç¯©é¸ï¼ˆä¸åŒç®¡ç†å“¡æ¥æ”¶ä¸åŒé€šçŸ¥ï¼‰
- [ ] ç®¡ç†å“¡æ´»å‹•æ—¥èªŒ
- [ ] ç¶²é ä»‹é¢ç®¡ç†ç®¡ç†å“¡
- [ ] ç®¡ç†å“¡ç¾¤çµ„æ¦‚å¿µï¼ˆå¦‚ï¼šè²¡å‹™çµ„ã€æ•™å‹™çµ„ï¼‰
- [ ] æ’ç­åˆ¶åº¦ï¼ˆç‰¹å®šæ™‚æ®µç‰¹å®šç®¡ç†å“¡ï¼‰

---

**å»ºç«‹æ—¥æœŸ**ï¼š2024/11/21  
**æœ€å¾Œæ›´æ–°**ï¼š2024/11/21  
**ç¶­è­·è€…**ï¼šFLB ç°½åˆ°ç³»çµ±åœ˜éšŠ
