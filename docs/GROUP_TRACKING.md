# ç¾¤çµ„è³‡è¨Šè¨˜éŒ„åŠŸèƒ½èªªæ˜

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

ç³»çµ±ç¾åœ¨æœƒè‡ªå‹•è¨˜éŒ„ä¾†è‡ª LINE ç¾¤çµ„çš„è¨Šæ¯ï¼ŒåŒ…æ‹¬ï¼š
- ç¾¤çµ„ ID
- ç¾¤çµ„åç¨±
- ç¾¤çµ„é¡å‹ï¼ˆgroup/roomï¼‰
- é¦–æ¬¡è¦‹åˆ°æ™‚é–“
- æœ€å¾Œæ´»å‹•æ™‚é–“
- ä½¿ç”¨è€…åœ¨ç¾¤çµ„ä¸­çš„æ´»å‹•è¨˜éŒ„

## ğŸ”„ è‡ªå‹•è¨˜éŒ„æ©Ÿåˆ¶

### 1. Webhook è¨Šæ¯è™•ç†

ç•¶ä½¿ç”¨è€…åœ¨ç¾¤çµ„ä¸­ç™¼é€è¨Šæ¯æ™‚ï¼Œç³»çµ±æœƒè‡ªå‹•ï¼š

1. **åµæ¸¬ä¾†æºé¡å‹**
   - å€‹äººè¨Šæ¯ï¼ˆuserï¼‰
   - ç¾¤çµ„è¨Šæ¯ï¼ˆgroupï¼‰
   - èŠå¤©å®¤è¨Šæ¯ï¼ˆroomï¼‰

2. **è¨˜éŒ„ç¾¤çµ„è³‡è¨Š**
   - è‡ªå‹•å‘ LINE API æŸ¥è©¢ç¾¤çµ„åç¨±
   - å»ºç«‹æˆ–æ›´æ–°ç¾¤çµ„è¨˜éŒ„
   - æ›´æ–°æœ€å¾Œæ´»å‹•æ™‚é–“

3. **é—œè¯ä½¿ç”¨è€…èˆ‡ç¾¤çµ„**
   - è¨˜éŒ„å“ªäº›ä½¿ç”¨è€…åœ¨å“ªäº›ç¾¤çµ„æ´»å‹•
   - è¿½è¹¤ä½¿ç”¨è€…çš„ç¾¤çµ„åˆ—è¡¨

### 2. è³‡æ–™çµæ§‹

#### ç¾¤çµ„è³‡æ–™ (groups.json)
```json
{
  "groupId": "C1234567890abcdef1234567890abcdef",
  "groupName": "æ¸¬è©¦ç¾¤çµ„",
  "type": "group",
  "firstSeenAt": "2025-01-20T10:00:00.000Z",
  "lastActivityAt": "2025-01-20T12:30:00.000Z",
  "memberCount": 0,
  "description": ""
}
```

#### ä½¿ç”¨è€…è³‡æ–™å¢å¼· (users.json)
```json
{
  "userId": "U1234567890abcdef1234567890abcdef",
  "displayName": "æ¸¬è©¦ä½¿ç”¨è€…",
  "userName": "æ¸¬è©¦ä½¿ç”¨è€…",
  "groups": [
    "C1234567890abcdef1234567890abcdef",
    "C9876543210fedcba9876543210fedcba"
  ]
}
```

## ğŸ”Œ API ç«¯é»

### ç²å–æ‰€æœ‰ç¾¤çµ„
```http
GET /api/groups
```

**å›æ‡‰ç¯„ä¾‹:**
```json
{
  "success": true,
  "groups": [
    {
      "groupId": "C1234567890abcdef1234567890abcdef",
      "groupName": "æ¸¬è©¦ç¾¤çµ„",
      "type": "group",
      "firstSeenAt": "2025-01-20T10:00:00.000Z",
      "lastActivityAt": "2025-01-20T12:30:00.000Z"
    }
  ],
  "total": 1
}
```

### ç²å–å–®ä¸€ç¾¤çµ„
```http
GET /api/groups/:groupId
```

**å›æ‡‰ç¯„ä¾‹:**
```json
{
  "success": true,
  "group": {
    "groupId": "C1234567890abcdef1234567890abcdef",
    "groupName": "æ¸¬è©¦ç¾¤çµ„",
    "type": "group",
    "firstSeenAt": "2025-01-20T10:00:00.000Z",
    "lastActivityAt": "2025-01-20T12:30:00.000Z"
  }
}
```

### æœå°‹ç¾¤çµ„
```http
GET /api/groups/search/:query
```

**ç¯„ä¾‹:**
```
GET /api/groups/search/æ¸¬è©¦
```

### æ›´æ–°ç¾¤çµ„åç¨±
```http
PATCH /api/groups/:groupId
Content-Type: application/json

{
  "groupName": "æ–°çš„ç¾¤çµ„åç¨±"
}
```

### ç²å–ç¾¤çµ„çµ±è¨ˆ
```http
GET /api/group-stats
```

**å›æ‡‰ç¯„ä¾‹:**
```json
{
  "success": true,
  "stats": {
    "totalGroups": 5,
    "activeGroups": 3,
    "inactiveGroups": 2,
    "groupTypes": {
      "group": 4,
      "room": 1
    }
  }
}
```

## ğŸ“Š è³‡æ–™åº«æ–¹æ³•

### ç¾¤çµ„ç®¡ç†
- `registerGroup(groupData)` - è¨»å†Šæˆ–æ›´æ–°ç¾¤çµ„
- `getGroup(groupId)` - ç²å–å–®ä¸€ç¾¤çµ„
- `getAllGroups()` - ç²å–æ‰€æœ‰ç¾¤çµ„
- `updateGroupActivity(groupId)` - æ›´æ–°æ´»å‹•æ™‚é–“
- `updateGroupName(groupId, newGroupName)` - æ›´æ–°ç¾¤çµ„åç¨±
- `getGroupCount()` - ç²å–ç¾¤çµ„ç¸½æ•¸
- `searchGroups(query)` - æœå°‹ç¾¤çµ„
- `recordGroupUserActivity(groupId, userId, displayName)` - è¨˜éŒ„ç¾¤çµ„ä½¿ç”¨è€…æ´»å‹•

## ğŸ¯ ä½¿ç”¨æƒ…å¢ƒ

### 1. ç›£æ§ç¾¤çµ„æ´»å‹•
ç³»çµ±æœƒè‡ªå‹•è¨˜éŒ„æ‰€æœ‰ç¾¤çµ„çš„æ´»å‹•ï¼Œæ‚¨å¯ä»¥ï¼š
- æŸ¥çœ‹å“ªäº›ç¾¤çµ„æœ€æ´»èº
- è¿½è¹¤ç¾¤çµ„æœ€å¾Œæ´»å‹•æ™‚é–“
- è­˜åˆ¥ä¸æ´»èºçš„ç¾¤çµ„

### 2. ä½¿ç”¨è€…ç¾¤çµ„é—œè¯
è¿½è¹¤ä½¿ç”¨è€…åƒèˆ‡çš„ç¾¤çµ„ï¼š
- æŸ¥çœ‹ä½¿ç”¨è€…åŠ å…¥äº†å“ªäº›ç¾¤çµ„
- åˆ†æä½¿ç”¨è€…åœ¨ä¸åŒç¾¤çµ„çš„æ´»å‹•

### 3. ç¾¤çµ„åˆ†æ
çµ±è¨ˆå’Œåˆ†æç¾¤çµ„è³‡æ–™ï¼š
- æ´»èºç¾¤çµ„æ•¸é‡ï¼ˆæœ€è¿‘7å¤©æœ‰æ´»å‹•ï¼‰
- ç¾¤çµ„é¡å‹åˆ†å¸ƒ
- ç¸½ç¾¤çµ„æ•¸é‡

## âš™ï¸ é…ç½®

ç¾¤çµ„è¨˜éŒ„åŠŸèƒ½é è¨­å•Ÿç”¨ï¼Œç„¡éœ€é¡å¤–é…ç½®ã€‚ç³»çµ±æœƒï¼š
1. è‡ªå‹•åµæ¸¬ç¾¤çµ„è¨Šæ¯
2. å˜—è©¦å¾ LINE API ç²å–ç¾¤çµ„åç¨±
3. å„²å­˜åˆ°æœ¬åœ° `data/groups.json`
4. é—œè¯ä½¿ç”¨è€…èˆ‡ç¾¤çµ„

## ğŸ“ æ³¨æ„äº‹é …

1. **LINE API æ¬Šé™**
   - éœ€è¦ Bot è¢«åŠ å…¥ç¾¤çµ„æ‰èƒ½ç²å–ç¾¤çµ„è³‡è¨Š
   - å¦‚æœç„¡æ³•ç²å–ç¾¤çµ„åç¨±ï¼Œå°‡ä½¿ç”¨ã€ŒæœªçŸ¥ç¾¤çµ„ã€

2. **è³‡æ–™æŒä¹…åŒ–**
   - ç¾¤çµ„è³‡æ–™å„²å­˜åœ¨ `data/groups.json`
   - è‡ªå‹•å‚™ä»½åˆ°æœ¬åœ°å¿«å–
   - æ”¯æ´å¤šæ¬¡å•Ÿå‹•ä¿ç•™è³‡æ–™

3. **æ•ˆèƒ½è€ƒé‡**
   - ç¾¤çµ„è³‡è¨ŠæŸ¥è©¢æœ‰ 10 ç§’è¶…æ™‚é™åˆ¶
   - å¤±æ•—æ™‚æœƒä½¿ç”¨é è¨­å€¼ç¹¼çºŒé‹ä½œ
   - ä¸æœƒé˜»å¡ä¸»è¦è¨Šæ¯è™•ç†æµç¨‹

## ğŸ” æ—¥èªŒè¼¸å‡º

ç³»çµ±æœƒè¼¸å‡ºä»¥ä¸‹æ—¥èªŒï¼š

```
æ”¶åˆ°è¨Šæ¯: æ¸¬è©¦è¨Šæ¯
ç”¨æˆ¶ ID: U1234567890abcdef1234567890abcdef
ä¾†æºé¡å‹: group
ğŸ“± ç²å–ç¾¤çµ„è³‡è¨Š: æ¸¬è©¦ç¾¤çµ„ (C1234567890abcdef1234567890abcdef)
ç¾¤çµ„å·²è¨»å†Š/æ›´æ–°: æ¸¬è©¦ç¾¤çµ„ (C1234567890abcdef1234567890abcdef)
è¨˜éŒ„ç¾¤çµ„æ´»å‹•: æ¸¬è©¦ä½¿ç”¨è€… (U1234567890abcdef1234567890abcdef) åœ¨ç¾¤çµ„ C1234567890abcdef1234567890abcdef
âœ… ç¾¤çµ„æ´»å‹•å·²è¨˜éŒ„: æ¸¬è©¦ä½¿ç”¨è€… åœ¨ æ¸¬è©¦ç¾¤çµ„
```

## ğŸš€ æ¸¬è©¦

### æ¸¬è©¦ç¾¤çµ„è¨˜éŒ„åŠŸèƒ½
1. å°‡ Bot åŠ å…¥ä¸€å€‹ LINE ç¾¤çµ„
2. åœ¨ç¾¤çµ„ä¸­ç™¼é€ä»»ä½•è¨Šæ¯
3. æª¢æŸ¥æ—¥èªŒç¢ºèªç¾¤çµ„å·²è¢«è¨˜éŒ„
4. å‘¼å« API ç¢ºèªè³‡æ–™ï¼š
   ```bash
   curl http://localhost:3000/api/groups
   ```

### æ¸¬è©¦ API ç«¯é»
```bash
# ç²å–æ‰€æœ‰ç¾¤çµ„
curl http://localhost:3000/api/groups

# ç²å–ç¾¤çµ„çµ±è¨ˆ
curl http://localhost:3000/api/group-stats

# æœå°‹ç¾¤çµ„
curl http://localhost:3000/api/groups/search/æ¸¬è©¦

# æ›´æ–°ç¾¤çµ„åç¨±
curl -X PATCH http://localhost:3000/api/groups/C1234567890abcdef1234567890abcdef \
  -H "Content-Type: application/json" \
  -d '{"groupName": "æ–°åç¨±"}'
```

## ğŸ“š ç›¸é—œæ–‡ä»¶

- [LINE Messaging API - Group](https://developers.line.biz/en/reference/messaging-api/#get-group-summary)
- [API æ–‡ä»¶](../docs/api/API_DOCUMENTATION.md)
- [è³‡æ–™åº«èªªæ˜](../src/googleSheetsDatabaseWithLocal.js)

