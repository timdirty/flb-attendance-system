# 💰 匯款文字功能測試案例

> **測試範圍**：文字訊息的匯款關鍵字偵測與語意過濾  
> **測試日期**：2025-11-21  
> **OCR 測試**：稍後處理

---

## 📋 測試準備

### 前置條件

1. ✅ 伺服器已啟動（本機或 Docker）
2. ✅ LINE Bot 已設定完成
3. ✅ 管理員 User ID 已設定
4. ✅ 匯款關鍵字已配置
5. ✅ 語意過濾規則已啟用

### 環境檢查

```bash
# 檢查 .env 設定
grep "REMITTANCE" .env
grep "ADMIN_USER_IDS" .env

# 檢查伺服器狀態
docker ps | grep flb-attendance-system
# 或
ps aux | grep node.*server.js
```

### 預設配置

**匯款關鍵字**（預設）：
- 匯款
- 轉帳
- 轉帳完成
- 已轉
- ATM

**語意過濾關鍵字**：
- **延後**：明天、明日、稍後、晚點、之後...
- **否定**：還沒、尚未、未匯、暫不匯...
- **詢問**：請問、如何匯、匯款方式...
- **疑問**：?、？、嗎、呢

---

## 🧪 測試案例

### 測試組 A：基本關鍵字偵測（正向案例）

#### A1. 單一關鍵字 - "匯款"
**測試訊息**：`我已經匯款了`

**預期結果**：
- ✅ Bot 回覆：「📄 已收到您的匯款資訊，將盡快為您確認。」
- ✅ 管理員收到 Flex Message 通知
- ✅ 記錄寫入 `src/data/remittance-records.json`

**實際結果**：


---

#### A2. 單一關鍵字 - "轉帳"
**測試訊息**：`我已經轉帳 1500 元了`

**預期結果**：
- ✅ Bot 回覆確認訊息
- ✅ 管理員收到通知，金額顯示 `NT$ 1,500`
- ✅ 金額正確解析

**實際結果**：


---

#### A3. 單一關鍵字 - "轉帳完成"
**測試訊息**：`轉帳完成`

**預期結果**：
- ✅ Bot 回覆確認訊息
- ✅ 管理員收到通知

**實際結果**：


---

#### A4. 單一關鍵字 - "已轉"
**測試訊息**：`已轉 NT$2000`

**預期結果**：
- ✅ Bot 回覆確認訊息
- ✅ 管理員收到通知，金額顯示 `NT$ 2,000`

**實際結果**：


---

#### A5. 單一關鍵字 - "ATM"
**測試訊息**：`ATM 轉帳完成，金額 3000`

**預期結果**：
- ✅ Bot 回覆確認訊息
- ✅ 管理員收到通知，金額顯示 `NT$ 3,000`

**實際結果**：


---

### 測試組 B：金額解析

#### B1. 純數字
**測試訊息**：`我匯款 1500`

**預期金額**：`1500`

**實際結果**：


---

#### B2. NT$ 格式
**測試訊息**：`已轉帳 NT$2000`

**預期金額**：`2000`

**實際結果**：


---

#### B3. 逗號分隔
**測試訊息**：`匯款 1,500 元`

**預期金額**：`1500` 或 `1,500`

**實際結果**：


---

#### B4. 中文數字單位
**測試訊息**：`轉帳 台幣 2000 元`

**預期金額**：`2000`

**實際結果**：


---

#### B5. 無金額
**測試訊息**：`我已經匯款了`

**預期金額**：空白或 `null`

**實際結果**：


---

### 測試組 C：語意過濾 - 延後（shouldDefer: true）

#### C1. "明天"
**測試訊息**：`明天處理匯款`

**預期結果**：
- ✅ Bot 回覆：「👀 已收到您的訊息，完成匯款後請再通知，我們會立即處理 🙏」
- ❌ **不觸發**管理員通知
- ✅ 記錄寫入 `src/data/remittance-intent-log.json`
- ✅ reason: `postpone`

**實際結果**：


---

#### C2. "稍後"
**測試訊息**：`稍後匯款給你`

**預期結果**：
- ✅ Bot 回覆延後訊息
- ❌ 不觸發通知

**實際結果**：


---

#### C3. "晚點"
**測試訊息**：`晚點轉帳 1500 元`

**預期結果**：
- ✅ Bot 回覆延後訊息
- ❌ 不觸發通知

**實際結果**：


---

### 測試組 D：語意過濾 - 否定（shouldDefer: true）

#### D1. "還沒"
**測試訊息**：`還沒匯款`

**預期結果**：
- ✅ Bot 回覆延後訊息
- ❌ 不觸發通知
- ✅ reason: `negative`

**實際結果**：


---

#### D2. "尚未"
**測試訊息**：`尚未轉帳`

**預期結果**：
- ✅ Bot 回覆延後訊息
- ❌ 不觸發通知

**實際結果**：


---

#### D3. "未匯"
**測試訊息**：`我未匯款`

**預期結果**：
- ✅ Bot 回覆延後訊息
- ❌ 不觸發通知

**實際結果**：


---

### 測試組 E：語意過濾 - 詢問（shouldDefer: true）

#### E1. "請問"
**測試訊息**：`請問如何匯款？`

**預期結果**：
- ✅ Bot 回覆延後訊息
- ❌ 不觸發通知
- ✅ reason: `inquiry`

**實際結果**：


---

#### E2. "匯款方式"
**測試訊息**：`匯款方式是什麼？`

**預期結果**：
- ✅ Bot 回覆延後訊息
- ❌ 不觸發通知

**實際結果**：


---

#### E3. "如何匯"
**測試訊息**：`如何匯款給你們？`

**預期結果**：
- ✅ Bot 回覆延後訊息
- ❌ 不觸發通知

**實際結果**：


---

### 測試組 F：語意過濾 - 疑問（shouldDefer: true）

#### F1. 問號 "?"
**測試訊息**：`我匯款了嗎?`

**預期結果**：
- ✅ Bot 回覆延後訊息
- ❌ 不觸發通知
- ✅ reason: `question`

**實際結果**：


---

#### F2. 全形問號 "？"
**測試訊息**：`需要匯款嗎？`

**預期結果**：
- ✅ Bot 回覆延後訊息
- ❌ 不觸發通知

**實際結果**：


---

#### F3. "嗎"
**測試訊息**：`可以匯款嗎`

**預期結果**：
- ✅ Bot 回覆延後訊息
- ❌ 不觸發通知

**實際結果**：


---

### 測試組 G：邊界案例

#### G1. 無關鍵字
**測試訊息**：`我已經付款了`

**預期結果**：
- ❌ 不觸發任何匯款流程
- ❌ 不回覆確認訊息

**實際結果**：


---

#### G2. 空白訊息
**測試訊息**：（空白或只有空格）

**預期結果**：
- ❌ 不觸發任何流程

**實際結果**：


---

#### G3. 關鍵字 + 語意過濾（優先級測試）
**測試訊息**：`明天我會匯款 1500 元`

**預期結果**：
- ✅ Bot 回覆延後訊息（語意過濾優先）
- ❌ 不觸發通知

**實際結果**：


---

#### G4. 混合大小寫（如有支援英文）
**測試訊息**：`ATM轉帳完成`

**預期結果**：
- ✅ 觸發匯款流程

**實際結果**：


---

### 測試組 H：管理員確認流程

#### H1. 點擊確認按鈕
**前置**：先發送 `我已經轉帳 1500 元了` 觸發通知

**操作**：管理員點擊 Flex Message 中的「✅ 已確認收款」按鈕

**預期結果**：
- ✅ 管理員收到：「✅ 已回覆客戶，金額 NT$1,500」
- ✅ 客戶自動收到：「✅ 已確認收到您的匯款：NT$1,500\n感謝！」
- ✅ 記錄狀態更新為 `confirmed`
- ✅ 記錄 `confirmedBy` 和 `confirmedAt`

**實際結果**：


---

#### H2. 重複點擊確認按鈕
**操作**：在同一筆記錄上再次點擊確認按鈕

**預期結果**：
- ⚠️ 提示「找不到對應的匯款紀錄」或「已經確認過」

**實際結果**：


---

## 📊 測試結果統計

### 通過率

| 測試組 | 案例數 | 通過 | 失敗 | 通過率 |
|--------|--------|------|------|--------|
| A. 基本關鍵字 | 5 |  |  |  |
| B. 金額解析 | 5 |  |  |  |
| C. 延後過濾 | 3 |  |  |  |
| D. 否定過濾 | 3 |  |  |  |
| E. 詢問過濾 | 3 |  |  |  |
| F. 疑問過濾 | 3 |  |  |  |
| G. 邊界案例 | 4 |  |  |  |
| H. 確認流程 | 2 |  |  |  |
| **總計** | **28** |  |  |  |

### 已知問題


### 改進建議


---

## 📝 測試執行記錄

**測試執行者**：  
**測試環境**：  
**開始時間**：  
**結束時間**：  
**測試版本**：  

---

**建立日期**：2025-11-21  
**最後更新**：2025-11-21
